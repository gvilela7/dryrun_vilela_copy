name: Create Branch in Target Repository

on:
  workflow_dispatch:

jobs:
  create-branch:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Checkout tools repo
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PIPELINE_ACCESS }}
        repository: gvilela7/dryrun_vilela
        ref: ${{ github.ref_name }}
        sparse-checkout: |
            text.txt
            naoMexe.txt
        path: tmp

    - name: Edit Files 
      run: |
        cd tmp
        echo "hello world" >> text.txt
        cat naoMexe.txt
        cat text.txt

    - name: List modified files
      if: ${{ always() }}
      id: modifiedFiles
      run: |
            echo "result<<EOF" >> $GITHUB_OUTPUT
            cho "ficheiros alterados: $(git ls-files -o -m --exclude-standard -- ':!:contrib/*' ':!node_modules/*')"
            echo "$(git ls-files -o -m --exclude-standard -- ':!:contrib/*' ':!node_modules/*' | tr '\n' ' ')" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT   

    - name: Commit Files
      if: ${{ steps.modifiedFiles.outputs.result != '' }}        
      run: |

          echo "${{steps.modifiedFiles.outputs.result}}"

          # npm install axios

          # node .github/GitVerifiedCommit/index.js \
          #       ${{secrets.PIPELINE_ACCESS}} \
          #       gvilela7 \
          #       dryrun_vilela \
          #       ${{ github.ref_name }} \
          #       "${{steps.modifiedFiles.outputs.result}}" \
          #       '[AUTO] Committing files updated by imports'                   

